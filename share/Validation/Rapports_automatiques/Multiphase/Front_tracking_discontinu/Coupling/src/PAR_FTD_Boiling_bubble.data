# Boiling bubble simulation #
# lance_test 4 ecarts #
# PARALLEL RUNS #
dimension 3

domaine dom_fluide
domaine dom_solide

Probleme_FT_Disc_gen pb1
Pb_conduction pb2

# Mailler dom_fluide
{  
 	pave pave1
	{ 
	origine 0. 0. 0.
	longueurs 1. 1. 1. 
	nombre_de_noeuds 101 101 201
	
	}
	{
	bord paroi1   			 X = 0.	    	0. <= Y <= 1.		0. <= Z <= 1.
	bord haut1    			 Z = 1.   	0. <= X <= 1.		0. <= Y <= 1.
	raccord local homogene bas1      Z = 0.	    	0. <= X <= 1.		0. <= Y <= 1.
	bord paroi1  			 X = 1.   	0. <= Y <= 1.		0. <= Z <= 1.
	bord paroi1   			 Y = 0.	    	0. <= X <= 1.		0. <= Z <= 1.
	bord paroi1    			 Y = 1.  	0. <= X <= 1.		0. <= Z <= 1.
	}
}
transformer dom_fluide x*0.008-0.004 y*0.008-0.004 z*0.016

Mailler dom_solide
{  
 	pave pave2
	{ 
	origine 0. 0. 0.
	longueurs 1. 1. 1. 
	nombre_de_noeuds 101 101 3
	
	}
	{
	bord paroi2    			 X = 0.	    	0. <= Y <= 1.		0. <= Z <= 1.
	raccord local homogene haut2     Z = 1.   	0. <= X <= 1.		0. <= Y <= 1.
	bord bas2     			 Z = 0.	    	0. <= X <= 1.		0. <= Y <= 1.
	bord paroi2   			 X = 1.   	0. <= Y <= 1.		0. <= Z <= 1.
	bord paroi2   			 Y = 0.	    	0. <= X <= 1.		0. <= Z <= 1.
	bord paroi2    			 Y = 1.  	0. <= X <= 1.		0. <= Z <= 1.
	}
}
transformer dom_solide x*0.008-0.004 y*0.008-0.004 z*0.0001-0.0001
 #
Scatter DOM_FLUIDE.Zones dom_fluide
Scatter DOM_SOLIDE.Zones dom_solide

VDF dis

Fluide_Incompressible  eau
Lire eau 
{
  	mu champ_uniforme       1 0.00028291
  	rho champ_uniforme      1 958
  	lambda champ_uniforme   1 0.67909
  	cp champ_uniforme       1 4215.7
  
  
}

Fluide_Incompressible vapeur
Lire vapeur
{
  mu champ_uniforme       1 1.2269e-05	
  rho champ_uniforme      1 0.59817
  lambda champ_uniforme   1 0.025096	
  cp champ_uniforme       1 2.0800e3
 
}

Fluide_diphasique fluide
Lire fluide
{
  fluide1 eau
  fluide0 vapeur
  sigma   Champ_Uniforme 1            0.058912	
  chaleur_latente Champ_Uniforme 1    -2256.43e3
}

Solide sol
Read sol
{
	rho Uniform_Field 1 8500.
	lambda Champ_Uniforme 1 234.    
	Cp Champ_Uniforme 1 376.
}


Schema_Euler_explicite  sch
Lire sch
{
	nb_pas_dt_max 100000000
	tinit 0.
	tmax  8.
	dt_min 6.e-7
	dt_max 6.e-7
        dt_impr -100000
	dt_sauv 1e-3
	seuil_statio -1
}

Champ_Uniforme gravite
Lire gravite 3 0. 0. -9.81
Associate fluide gravite
Associate sol gravite

Navier_stokes_FT_disc                         hydraulique
Transport_interfaces_FT_disc                  interf
convection_diffusion_temperature_ft_disc      thermique
convection_diffusion_temperature_ft_disc      thermique_vapeur
Associate pb1 dom_fluide
Associate pb1 hydraulique
Associate pb1 thermique
Associate pb1 thermique_vapeur
Associate pb1 interf
Associate pb1 fluide

Associate pb2 dom_solide
Associate pb2 sol

Probleme_Couple pbc
Associate pbc pb1
Associate pbc pb2
Associate pbc sch
Discretize pbc dis

system "mkdir -p lata"
Lire pb1
{
	
	hydraulique
	{
	 	modele_turbulence sous_maille_wale
        	{
         	  Cw               1.e-16
         	  turbulence_paroi negligeable
        	}
		solveur_pression GCP { optimized precond ssor { omega 1.5 } seuil 1e-12 impr }
		convection { quick }
		diffusion { }
		conditions_initiales { vitesse champ_uniforme 3 0. 0. 0. }
		
		equation_interfaces_proprietes_fluide interf
		equation_temperature_mpoint thermique
		equation_temperature_mpoint_vapeur thermique_vapeur
		
		boundary_conditions 
		{
		paroi1   paroi_fixe 
		bas1     paroi_fixe 
		haut1    sortie_libre_rho_variable champ_front_uniforme 1 0.
        	}
	}
	
	
	interf
	{
		interpolation_repere_local
		methode_transport vitesse_interpolee hydraulique
	        conditions_initiales { fonction

(x^2+y^2+(z-(0.000861)*(0.4573484))^2-0.000861^2)

} 
		iterations_correction_volume 2
 methode_interpolation_v vdf_lineaire
        	n_iterations_distance 25
		 remaillage {
  pas 1.e-4
  nb_iter_remaillage 2
			critere_arete 0.35
  pas_lissage 1.e-3
  lissage_courbure_iterations_systematique 1
  lissage_courbure_iterations_si_remaillage 3
  lissage_courbure_coeff -0.05
  nb_iter_barycentrage 2
  relax_barycentrage 1.00
  facteur_longueur_ideale 1.45
  nb_iter_correction_volume 8
  seuil_dvolume_residuel 1e-20
			}
		collisions
		{
                active
		Juric_local
                type_remaillage thomas { distance_interface_element_max 2 }
  phase_continue 1
 }
		boundary_conditions
		{
		bas1  paroi_FT_disc constant champ_front_fonc_xyz 1 80*abs(cos(2*3.1415/0.0057820822264010741*sqrt(x*x+y*y)))+40
		paroi1 paroi_FT_disc symetrie
		haut1   paroi_FT_disc symetrie
		}
	}
	
	thermique
	{
		equation_interface interf
		equation_navier_stokes hydraulique
		phase 1
 		stencil_width 25
                diffusion { }
                convection { quick }
                boundary_conditions
                {
			bas1   echange_contact_VDF_FT_Disc {
					autre_probleme pb2
					autre_bord haut2 
					autre_champ_temperature temperature 
					nom_mon_indicatrice indicatrice_interf 
					phase 1
	}
			haut1  FRONTIERE_OUVERTE T_EXT CHAMP_FRONT_UNIFORME 1 0.
			paroi1 PAROI_ADIABATIQUE
                }
                CONDITIONS_INITIALES { TEMPERATURE_THERMIQUE CHAMP_FONC_XYZ dom_fluide 1 (-12/(2*0.000861)*Z+6.)*(Z<2*0.000861)-6.*(Z>2*0.000861) }
	}
	
	
	thermique_vapeur
	{
		EQUATION_INTERFACE INTERF
		EQUATION_NAVIER_STOKES HYDRAULIQUE
		PHASE 0
 		STENCIL_WIDTH 25
                DIFFUSION { }
                CONVECTION { QUICK }
		
                BOUNDARY_CONDITIONS
                {
			bas1   ECHANGE_CONTACT_VDF_FT_DISC {
					AUTRE_PROBLEME pb2
					AUTRE_BORD haut2 
					AUTRE_CHAMP_TEMPERATURE TEMPERATURE 
					NOM_MON_INDICATRICE INDICATRICE_INTERF 
					PHASE 0
				}
			haut1  FRONTIERE_OUVERTE T_EXT CHAMP_FRONT_UNIFORME 1 0.
			paroi1 PAROI_ADIABATIQUE
                }
                CONDITIONS_INITIALES { TEMPERATURE_THERMIQUE_VAPEUR CHAMP_FONC_XYZ dom_fluide 1 (-12/(2*0.000861)*Z+6.)*(Z<2*0.000861)-6.*(Z>2*0.000861) }
	}
	
	
	POSTRAITEMENT 
	{
		CHAMPS DT_POST 1.E-4
		{
			VITESSE ELEM
			TEMPERATURE_THERMIQUE ELEM
		}
	}

 
LISTE_POSTRAITEMENTS
{
	
    postraitement_ft_lata post1 { 
     format Lata 
     fichier lata/post 
     champs dt_post 1.0e-5 { 
        VOLUME_MAILLE elem 
        indicatrice_interf elem 
        temperature_thermique elem 
        vitesse faces 
        pression elem 
        mpoint_thermique elem 
        pression_laplacien_d elem 
        second_membre_projection elem 
        interfacial_area elem 
        vitesse_conv_thermique faces 
        vitesse_delta_interface faces 
        terme_convection_vitesse faces 
        terme_diffusion_vitesse faces 
        # flux_tmp_interf faces  #
     } 
     interfaces interf { 
        courbure som 
        vitesse som 
        vitesse_repere_local som 
        COMPO_CONNEXE elem 
        PE elem 
        PE_LOCAL elem 
     }

    }
    } 
}

Read pb2
{
	Conduction
	{
		diffusion { }
		initial_conditions {
			temperature Champ_Uniforme 1 6.
			}
		boundary_conditions {
			paroi2 symetrie
			bas2 paroi_flux_impose Champ_front_fonc_xyz 1 2471144*exp(-(x*x+y*y)/(3.6067*10^(-7)))
			haut2  echange_contact_VDF_FT_Disc_solid {
				autre_probleme pb1
				autre_bord bas1 
				autre_champ_temperature_indic1 temperature_thermique
				autre_champ_temperature_indic0 temperature_thermique_vapeur
				autre_champ_indicatrice indicatrice_interf 
			}

		}
		}
	
Post_processing
	{

		Format lata
		fields dt_post 1.e-3
		{
		    temperature elem
		}
	}

	
}


Solve pbc
FIN

			     
